import { Page } from "page.slint";
import { Slider } from "std-widgets.slint";
import { ComboBox } from "../widgets/combo-box.slint";

component SettingsOption inherits Rectangle {
    in property <string> option_name: "Title";
    in property <[image]> icons;
    in property <bool> has-icon: true;
    in property <angle> icon-angle: 0deg;
    in property <int> current-icon: 0;
    in-out property <brush> colorize: #000;
    border-color: #77777707;
    border-width: 1px;
    border-radius: 8px;
    background: #77777703;
    padding: 10px;
    height: layout.min-height+self.padding;
    layout:=HorizontalLayout {
        padding: root.padding;
        spacing: 4px;
        VerticalLayout {
            alignment: center;
            Rectangle {
                width: has-icon?14px:0px;
                height: has-icon?14px:0px;
                for icon[index] in icons :
                Image{
                    opacity: current-icon == index?1.0:0.0;
                    rotation-angle: icon-angle;
                    colorize: root.colorize;
                    source: icon;
                    image-fit: contain;
                    height: parent.height;
                    width: parent.width;
                    animate opacity {
                        duration: 75ms;
                        easing: cubic-bezier(0, 0.0, 0.75, 1);
                    }
                }
            }
        }
        option_name:=Text {
            vertical-alignment: center;
            text: root.option-name;
            width: self.min-width;
            font-size: 14px;
            font-weight: 500;
            color: root.colorize;
        }
        Rectangle {
            @children
        }
    }
}

export component SettingsPage inherits Page {
    header: "设置";
    in-out property <bool> dark:false;
    in-out property <brush> option-colorize: dark?@linear-gradient(135deg,#d4d4d4af,#d7d7d7af):@linear-gradient(135deg,#2b2b2baf,#282828af);
    in-out property <brush> option-border-color: dark?#ffffff0f:#00000007;
    in-out property <brush> option-bg-color: dark?#ffffff07:#00000003;
    in-out property <float> win-opacity:0;
    background: dark?#1f1f1f:#fefefe;
    animate option-bg-color,option-border-color,option-colorize {
        duration: 75ms;
        easing: cubic-bezier(0, 0.0, 0.75, 1);
    }
    VerticalLayout {
        x:0px;
        y:0px;
        spacing: 8px;
        padding-left: -10px;
        padding-right: -10px;
        alignment: start;
        opacity:=SettingsOption {
            colorize: option-colorize;
            has-icon: true;
            icons: [@image-url("../../res/icons/settings/opacity.svg")];
            option-name: "透明度";
            icon-angle: 225deg;
            border-color: option-border-color;
            background: option-bg-color;
            HorizontalLayout {
                alignment: end;
                Slider {
                    width: 125px;
                    minimum: 20;
                    value: 100;
                    changed => {
                        root.win-opacity = self.value / self.maximum;
                    }
                }
            }
        }
        themes:=SettingsOption {
            colorize: option-colorize;
            has-icon: true;
            icons: [@image-url("../../res/icons/settings/dark.svg"),@image-url("../../res/icons/settings/light.svg")];
            border-color: option-border-color;
            background: option-bg-color;
            current-icon: dark?0:1;
            option-name: "主题";
            HorizontalLayout {
                alignment: end;
                ComboBox {
                    bg-color: dark?#02020230:#fdfdfd30;
                    text-color: dark?#aaaaaa:#555555;
                    border-color: (dark?option-bg-color:option-bg-color).mix(#777,0.75);
                    popup-bg-color: dark?#1f1f1f:#fdfdfd;
                    popup-border-color: self.border-color;
                    current-value: "白色";
                    width: 100px;
                    values: ["白色","深色"];
                    selected => {
                        dark = self.current-value == "深色";
                    }
                }
                // ComboBox {
                //     current-value: "白色";
                //     width: 100px;
                //     model: ["白色","深色"];
                //     selected => {
                //         // self.enabled = false;
                //         dark = self.current-value == "深色";
                //     }
                // }

                // Switch {
                //     checked: false;
                //     toggled => {
                //         dark = self.checked;
                //     }
                // }
            }
        }
    }
}